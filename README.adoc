:spring_version: current
:spring_boot_version: current
:DispatcherServlet: http://docs.spring.io/spring/docs/{spring_version}/javadoc-api/org/springframework/web/servlet/DispatcherServlet.html
:SpringApplication: http://docs.spring.io/spring-boot/docs/{spring_boot_version}/api/org/springframework/boot/SpringApplication.html
:SpringBootSecurity: http://docs.spring.io/spring-boot/docs/{spring_boot_version}/reference/htmlsingle/#boot-features-security
:images: https://raw.githubusercontent.com/spring-guides/gs-securing-web/main/images
:toc:
:icons: font
:source-highlighter: prettify
:project_id: gs-securing-web

This guide walks you through the process of creating a simple web application with
resources that are protected by Spring Security.

== What You Will Build

You will build a Spring MVC application that secures the page with a login form that is
backed by a fixed list of users.

== What You Need

:java_version: 17
include::https://raw.githubusercontent.com/spring-guides/getting-started-macros/main/prereq_editor_jdk_buildtools.adoc[]

include::https://raw.githubusercontent.com/spring-guides/getting-started-macros/main/how_to_complete_this_guide.adoc[]

[[scratch]]
== How can it be created from scratch?

* Via Spring Initializer
    ** Already configured. You can use this https://start.spring.io/#!type=maven-project&language=java&packaging=jar&jvmVersion=11&groupId=com.example&artifactId=securing-web&name=securing-web&description=Demo%20project%20for%20Spring%20Boot&packageName=com.example.securing-web&dependencies=web,thymeleaf[pre-initialized project] and click Generate to download a ZIP file. This project is configured to fit the examples in this tutorial.
    ** From scratch.
        *** Navigate to https://start.spring.io.
            **** Choose either Gradle or Maven and the language you want to use. This guide assumes that you chose Java.
            **** Click *Dependencies* and select *Spring Web* and *Thymeleaf*.
            **** Click *Generate*.
            **** Download the resulting ZIP file, which is an archive of a web application that is configured with your choices.
        *** If your IDE has the Spring Initializr integration, you can complete this process from your IDE.


[[initial]]
== Create an Unsecured Web Application

* Web application views
    ** home page
        *** Defined in `src/main/resources/templates/home.html` -- via Thymeleaf template --
    ** "Hello, World" page
       *** Defined in `src/main/resources/templates/hello.html` -- via Thymeleaf template --
    ** login page
        *** Defined in `src/main/resources/templates/login.html` -- via Thymeleaf template --

* Web application is based on Spring MVC
    ** Configure Spring MVC
    ** Set up view controllers to expose these templates
        *** Defined in `src/main/java/com/example/securingweb/MvcConfig.java`


[[initial]]
== Set up Spring Security

* If Spring Security is on the classpath -> Spring Boot {SpringBootSecurity}[automatically secures all HTTP endpoints]
with "`basic`" authentication.
    ** Ways to add Spring Security to the classpath
        *** With Gradle
`implementation 'org.springframework.boot:spring-boot-starter-security'`
//  Temporary explicit version to fix Thymeleaf bug
`implementation 'org.thymeleaf.extras:thymeleaf-extras-springsecurity6:3.1.1.RELEASE'`
`implementation 'org.springframework.security:spring-security-test'`
        *** With Maven
`<dependency>
<groupId>org.springframework.boot</groupId>
<artifactId>spring-boot-starter-security</artifactId>
</dependency>`
`<dependency>
<groupId>org.thymeleaf.extras</groupId>
<artifactId>thymeleaf-extras-springsecurity6</artifactId>
<version>3.1.1.RELEASE</version>
</dependency>`
`<dependency>
<groupId>org.springframework.security</groupId>
<artifactId>spring-security-test</artifactId>
<scope>test</scope>
</dependency>`
    ** Apply security configuration -- `src/main/java/com/example/securingweb/WebSecurityConfig.java` --
        *** `@EnableWebSecurity`
            **** enable Spring Security's web security support
            **** provide Spring MVC integration
            **** `SecurityFilterChain` defines which URL paths should be secured and which not
            **** `UserDetailsService` sets up an in-memory user store
* You can further customize the security settings.


[[run_the_app]]
== How to run the Application

The Spring Initializr creates an application class for you. In this case, you need not
modify the class. The following listing (from
`src/main/java/com/example/securingweb/SecuringWebApplication.java`) shows the application
class:

====
[source,java]
----
include::complete/src/main/java/com/example/securingweb/SecuringWebApplication.java[]
----
====

include::https://raw.githubusercontent.com/spring-guides/getting-started-macros/main/build_an_executable_jar_subhead.adoc[]
include::https://raw.githubusercontent.com/spring-guides/getting-started-macros/main/build_an_executable_jar_with_both.adoc[]


Once the application starts up, point your browser to `http://localhost:8080`. You should
see the home page, as the following image shows:

image::{images}/home.png[The application's home page]

When you click on the link, it attempts to take you to the greeting page at `/hello`.
However, because that page is secured and you have not yet logged in, it takes you to the
login page, as the following image shows:

image::{images}/login.png[The login page]

NOTE: If you jumped down here with the unsecured version, you do not see the login page.
You should back up and write the rest of the security-based code.

At the login page, sign in as the test user by entering `user` and `password` for the
username and password fields, respectively. Once you submit the login form, you are
authenticated and then taken to the greeting page, as the following image shows:

image::{images}/greeting.png[The secured greeting page]

If you click on the *Sign Out* button, your authentication is revoked, and you are
returned to the login page with a message indicating that you are logged out.


